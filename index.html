<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>PWA Ynov</title>
    <meta charset="UTF-8" />
    <meta name="description" content="A sandbox app around PWA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="manifest" href="manifest.json" />
    <script
      async
      src="https://cdn.jsdelivr.net/npm/pwacompat@2.0.9/pwacompat.min.js"
      integrity="sha384-VcI6S+HIsE80FVM1jgbd6WDFhzKYA0PecD/LcIyMQpT4fMJdijBh0I7Iblaacawc"
      crossorigin="anonymous"
    ></script>
    <script src="scripts/app.js"></script>
    <script src="assets/imgs/imageDictionary.js"></script>
    <script src="assets/imgs/tiny/tinyImageDictionary.js"></script>
    <script src="scripts/image.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/progressive-image.js/dist/progressive-image.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/progressive-image.js/dist/progressive-image.js"></script>
    <script>
      let differedPrompt;
      let installButton;
    //   this.addEventListener('load', function (_event) {
    //     installButton = document.getElementById('install_button');
    //     this.addEventListener('beforeinstallprompt', function (event) {
    //       event.preventDefault();
    //       differedPrompt = event;
    //     });

    //     if (window.matchMedia('(display-mode: standalone)').matches) {
    //       installButton.style.display = 'none';
    //     }

    //     installButton.addEventListener('click', promptInstall);
    //   });

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const btn = document.getElementById('install_button');

        btn.addEventListener('click', (e) => {
          deferredPrompt.prompt();

          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('A2HS prompt accepté');
            } else {
              console.log('A2HS prompt décliné');
            }
            deferredPrompt = null;
          });
        });
      });

    //   const promptInstall = (e) => {
    //     installButton.disabled = true;
    //     differedPrompt.prompt();
    //     differedPrompt.userChoice
    //       .then((choiceResult) => {
    //         if (choiceResult.outcome === 'accepted') {
    //           console.log('User accepted the A2HS prompt');
    //           installButton.style.display = 'none';
    //         } else {
    //           console.log('User dismissed the A2HS prompt');
    //           installButton.disabled = false;
    //           installButton.removeEventListener('click');
    //           installButton.addEventListener('click', promptInstall);
    //         }
    //         differedPrompt = null;
    //       })
    //       .catch(console.error);
    //   };
    </script>
  </head>

  <body>
    <div class="app-header">
      <h1>Sandbox PWA Ynov</h1>
      <button id="install_button" type="button" value="Install">Install</button>
    </div>
    <div id="gallery"></div>
  </body>
</html>
